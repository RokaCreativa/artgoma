generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Event {
  id          Int      @id @default(autoincrement())
  name        String
  slug        String
  date        DateTime
  place       String
  isActive    Boolean  @default(true)
  description String?
  images      String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Visits Visit[]
}

model User {
  id          Int     @id @default(autoincrement())
  name        String
  email       String  @unique
  password    String?
  image       String?
  phone       String?
  isActive    Boolean @default(true)
  badge       String?
  attendances Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Visits Visit[]
}

model Visit {
  id             Int      @id @default(autoincrement())
  eventId        Int?
  userId         Int
  companions     String
  date           DateTime
  isCanceled     Boolean  @default(false)
  collaboratorId Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Event        Event?        @relation(fields: [eventId], references: [id])
  User         User          @relation(fields: [userId], references: [id])
  Collaborator Collaborator? @relation(fields: [collaboratorId], references: [id])
}

model Collaborator {
  id       Int     @id @default(autoincrement())
  name     String
  slogan   String?
  slug     String? @unique
  code     String  @unique
  image    String?
  email    String  @unique
  
  // Arreglo temporal para permitir nulos mientras migramos (si falla)
  phone    String?
  address  String?
  isActive Boolean @default(true)
  company  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Visits Visit[]
}

// -------------------------------------------------------------
//  GALERÍA DE ARTE (NUEVOS MODELOS PARA INTEGRACIÓN UNIFICADA)
// -------------------------------------------------------------

model Artwork {
  id          Int      @id @default(autoincrement())
  title       String
  artist_name String?  // Nombre denormalizado para búsquedas rápidas
  
  width       Float?
  height      Float?
  depth       Float?
  
  price       Float?
  year        Int?
  image       String?  // URL de la imagen (Supabase)
  
  genreId     Int?
  techniqueId Int?
  
  createdAt   DateTime @default(now())
  
  Genre       Genre?     @relation(fields: [genreId], references: [id])
  Technique   Technique? @relation(fields: [techniqueId], references: [id])
}

model Genre {
  id       Int       @id @default(autoincrement())
  name     String
  Artworks Artwork[]
}

model Technique {
  id       Int       @id @default(autoincrement())
  name     String
  Artworks Artwork[]
}
